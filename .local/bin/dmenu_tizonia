#!/bin/bash

# If st-tizonia already started, focus it and exit
[[ "$(xdotool search --class st-tizonia)" != "" ]] && xdo activate -N st-tizonia && exit 0

# Have to manually define playlists until
# tizonia has a way to list playlists
tizc=~/.config/tizonia
spotify=$(cat "$tizc/spotify.txt")
gmusic=$(cat "$tizc/gmusic.txt")

# Combine and remove duplicates
plists=`(echo "${spotify[@]}" && echo "${gmusic[@]}") | sort -du`

# Add quit to options
options=$(echo "$plists" && echo "quit")

# Launch dmenu
choice=$(echo "${options[@]}" | dmenu -i -p 'Playlist: ')

# If invalid choice or quit, exit
[[ "$choice" == "quit" || "$choice" == "" ||  "$(echo "${options[@]}" | grep "$choice")" == "" ]] && \
  echo "Program terminated." && exit 1

# Default to spotify playlists
tizopt="--spotify-playlist"

# Fall back to google music playlists
[[ "$(echo "${spotify[@]}" | grep "$choice")" == "" ]] && \
[[ "$(echo "${gmusic[@]}" | grep "$choice")" != "" ]] && \
  tizopt="--gmusic-playlist"

# Launch tizonia in st with class st-tizonia
st -c st-tizonia -t "tizonia - $choice" -e sh -c "tizonia $tizopt '$choice'"

